<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ SSE-—Å–µ—Ä–≤–µ—Ä–æ–º</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        input, button { margin: 5px 0; padding: 5px; }
        .log { margin-top: 20px; background: #f0f0f0; padding: 10px; max-height: 300px; overflow-y: auto; }
    </style>
</head>
<body>
<h1>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ SSE-—Å–µ—Ä–≤–µ—Ä–æ–º</h1>

<h3>–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ</h3>
<input type="text" id="sender" placeholder="–ò–º—è –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è" /><br />
<input type="text" id="message" placeholder="–¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è" /><br />
<button onclick="sendMessage()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ</button>

<h3>–£–≤–µ–ª–∏—á–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</h3>
<button onclick="incrementNotifications()">+1 –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ</button>

<h3>–õ–æ–≥ —Å–æ–±—ã—Ç–∏–π</h3>
<div class="log" id="log"></div>

<script>
    const logDiv = document.getElementById('log');

    function log(message) {
        const entry = document.createElement('div');
        entry.textContent = message;
        logDiv.appendChild(entry);
        logDiv.scrollTop = logDiv.scrollHeight;
    }

    function sendMessage() {
        const sender = document.getElementById('sender').value;
        const text = document.getElementById('message').value;

        fetch('http://localhost:3000/send-message', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ sender, text })
        }).then(res => res.json())
                .then(data => log(`üì§ –°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ: ${JSON.stringify(data.message)}`))
                .catch(err => log(`‚ùå –û—à–∏–±–∫–∞: ${err.message}`));
    }

    function incrementNotifications() {
        fetch('http://localhost:3000/increment-notifications', {
            method: 'POST'
        }).then(res => res.json())
                .then(data => log(`üîî –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è: ${data.payload.count}`))
                .catch(err => log(`‚ùå –û—à–∏–±–∫–∞: ${err.message}`));
    }

    const eventSource = new EventSource('http://localhost:3000/sse');

    eventSource.addEventListener('ChatMessage', e => {
        const data = JSON.parse(e.data);
        log(`üì© –ù–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ: ${data.text} –æ—Ç ${data.sender}`);
    });

    eventSource.addEventListener('NotificationsAvailable', e => {
        const data = JSON.parse(e.data);
        log(`üì¢ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω—ã: ${data.count}`);
    });

    eventSource.addEventListener('Ping', () => log('üîÑ Ping'));
</script>
</body>
</html>
